{% extends 'base.html' %}
{% load static %}

{% block title %}Dean Office Dashboard - USJ Cleaning App{% endblock %}

{% block extra_css %}
<style>
  /* Override base.html gradient background for cleaner dean-style look */
  body {
    background: #f8f9fa !important;
    min-height: 100vh;
  }
  
  /* Align dean dashboard styling to assistant dashboard look */
  .unit-badge { background:#0d6efd; color:#fff; padding:5px 12px; border-radius:20px; font-size:.85rem; display:inline-block; margin:4px; }
  .badge-status { padding:.35rem .6rem; border-radius:10rem; font-size:.75rem; font-weight:600; text-transform:uppercase; }
  .badge-pending { background-color:#fff3cd; color:#856404; }
  .badge-in-progress { background-color:#cff4fc; color:#055160; }
  .badge-completed { background-color:#d1e7dd; color:#0f5132; }
  .badge-verified { background-color:#cfe2ff; color:#084298; }
  .empty-state { text-align:center; padding:30px; color:#6c757d; }
  .empty-state i { font-size:3rem; opacity:.3; margin-bottom:15px; }
  
  /* Month stats badges */
  .stats-badge { display: inline-block; padding: .5rem 1rem; margin: .25rem; border-radius: .5rem; font-weight: 600; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header (match assistant style) -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 mb-0">Dean Office Dashboard</h1>
      <div class="d-flex align-items-center gap-2">
        
        <!-- SIMPLIFIED Faculty Filter -->
        {% if faculties|length > 1 %}
        <form method="get" class="me-2">
          <select name="faculty" id="faculty" class="form-select form-select-sm" onchange="this.form.submit()" style="width: 250px;">
            <option value="">All Faculties</option>
            {% for faculty in faculties %}
              <option value="{{ faculty.id }}" {% if selected_faculty and faculty.id == selected_faculty.id %}selected{% endif %}>
                {{ faculty.faculty_name }}
              </option>
            {% endfor %}
          </select>
        </form>
        {% elif selected_faculty %}
        <span class="badge bg-info text-dark me-2 px-3 py-2">
          <i class="fas fa-building me-1"></i>{{ selected_faculty.faculty_name }}
        </span>
        {% endif %}
        
        <form method="get" class="d-flex align-items-center me-2">
          {# Preserve faculty selection in query when changing month #}
          {% if selected_faculty %}
            <input type="hidden" name="faculty" value="{{ selected_faculty.id }}" />
          {% endif %}
          <label for="month" class="me-2 mb-0 small text-muted">Month</label>
          <input type="month" id="month" name="month" class="form-control form-control-sm" value="{{ selected_month }}" style="width: 160px;" />
          <button type="submit" class="btn btn-sm btn-outline-primary ms-2">Apply</button>
        </form>
                        {% if selected_faculty %}
                            <a href="{% url 'cleaning:faculty_cleaning_report' selected_faculty.id %}?year={{ selected_year }}&month={{ selected_month_num }}" class="btn btn-primary btn-sm">Reports</a>
                        {% else %}
                            <a href="{% url 'cleaning:faculty_list_report' %}" class="btn btn-primary btn-sm">Reports</a>
                        {% endif %}
        <a href="{% url 'logout' %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to logout?');">
          <i class="fas fa-sign-out-alt me-1"></i>Logout
        </a>
      </div>
    </div>
    
    <p class="text-muted mb-3">
      <i class="fas fa-user-tag me-2"></i>{{ user.get_role_display }}
      <span class="ms-3"><i class="far fa-calendar me-2"></i>{% now "l, F d, Y" %}</span>
    </p>

    <!-- Monthly Cleaning Details Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Monthly Cleaning Details</h5>
            <span class="badge bg-light text-dark">{{ selected_month }}</span>
        </div>
        <div class="card-body">
            {% if selected_faculty %}
                {# Removed monthly stats badges per request #}

                {% if monthly_records %}
                <div class="table-responsive">
                    <table class="table table-hover table-sm">
                        <thead class="table-light">
                            <tr>
                                <th>Unit</th>
                                <th>Activity</th>
                                <th>Scheduled Date</th>
                                <th>Completed/Verified</th>
                                <th>Assistant</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for record in monthly_records %}
                            <tr>
                                <td>{{ record.unit.unit_name }}</td>
                                <td>{{ record.activity.activity_name }}</td>
                                <td>{{ record.scheduled_date|date:"M d, Y" }}</td>
                                <td>
                                    {% if record.verified_date %}
                                        {{ record.verified_date|date:"M d, Y" }}
                                    {% elif record.completed_date %}
                                        {{ record.completed_date|date:"M d, Y" }}
                                    {% else %}
                                        <span class="text-muted">â€”</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if record.assigned_to %}
                                        {{ record.assigned_to.get_full_name|default:record.assigned_to.username }}
                                    {% else %}
                                        <span class="text-muted">Unassigned</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if record.status == 'PENDING' %}
                                        <span class="badge-status badge-pending">Pending</span>
                                    {% elif record.status == 'IN_PROGRESS' %}
                                        <span class="badge-status badge-in-progress">In Progress</span>
                                    {% elif record.status == 'COMPLETED' %}
                                        <span class="badge-status badge-completed">Completed</span>
                                    {% elif record.status == 'VERIFIED' %}
                                        <span class="badge-status badge-verified">Verified</span>
                                    {% else %}
                                        <span class="badge-status">{{ record.status }}</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>No cleaning records found for this month.</p>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-filter"></i>
                    <p>Please select a faculty to view monthly cleaning details</p>
                </div>
            {% endif %}
        </div>
    </div>

    {# Removed KPI and Current Cleaning Operations sections per request #}
</div>
{% endblock %}

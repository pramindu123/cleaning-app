{% extends 'base.html' %}
{% load static %}

{% block title %}Assistant Dashboard - USJ Cleaning App{% endblock %}

{% block extra_css %}
<style>
  /* Override base.html gradient background for cleaner dean-style look */
  body {
    background: #f8f9fa !important;
    min-height: 100vh;
  }
  
  /* Align assistant dashboard styling to dean dashboard look */
  .unit-badge { background:#0d6efd; color:#fff; padding:5px 12px; border-radius:20px; font-size:.85rem; display:inline-block; margin:4px; }
  .badge-status { padding:.35rem .6rem; border-radius:10rem; font-size:.75rem; font-weight:600; text-transform:uppercase; }
  .badge-pending { background-color:#fff3cd; color:#856404; }
  .badge-in-progress { background-color:#cff4fc; color:#055160; }
  .badge-completed { background-color:#d1e7dd; color:#0f5132; }
  .badge-verified { background-color:#cfe2ff; color:#084298; }
  .empty-state { text-align:center; padding:30px; color:#6c757d; }
  .empty-state i { font-size:3rem; opacity:.3; margin-bottom:15px; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header (match dean style) -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 mb-0">Assistant Dashboard</h1>
      <a href="{% url 'logout' %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to logout?');">
        <i class="fas fa-sign-out-alt me-1"></i>Logout
      </a>
    </div>
    <p class="text-muted mb-3">
      <i class="fas fa-user-tag me-2"></i>{{ user.get_role_display }}
      <span class="ms-3"><i class="far fa-calendar me-2"></i>{% now "l, F d, Y" %}</span>
    </p>

    <!-- My Activities (from assigned units) -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-secondary text-white">
                    <i class="fas fa-broom me-2"></i>My Activities
                </div>
                <div class="card-body">
                {% if my_activities %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th style="width: 20%">Unit</th>
                                    <th style="width: 35%">Activity</th>
                                    <th style="width: 15%">Frequency</th>
                                    <th style="width: 15%">Status</th>
                                    <th style="width: 15%" class="text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for act in my_activities %}
                                <tr>
                                    <td>
                                        <strong>{{ act.unit.unit_name }}</strong><br>
                                        <small class="text-muted">{{ act.unit.get_full_location }}</small>
                                    </td>
                                    <td>{{ act.activity_name }}</td>
                                    <td><span class="badge bg-secondary">{{ act.get_frequency_display }}</span></td>
                                    <td>
                                        {% if act.is_active %}
                                            <span class="badge bg-success">Active</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Inactive</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <a href="{% url 'cleaning:cleaning_record_create' %}?unit={{ act.unit.id }}&activity={{ act.id }}" 
                                           class="btn btn-sm btn-primary">
                                            <i class="fas fa-check-circle me-1"></i>Mark Now
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if activities_total > my_activities|length %}
                    <div class="text-center text-muted small">
                        Showing {{ my_activities|length }} of {{ activities_total }} activities
                    </div>
                    {% endif %}
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-broom"></i>
                        <p>No activities found for your assigned units</p>
                    </div>
                {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Completed Activities -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <i class="fas fa-check-double me-2"></i>Completed Activities
                </div>
                <div class="card-body">
                {% if completed_activities %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th style="width: 18%">Unit</th>
                                    <th style="width: 22%">Activity</th>
                                    <th style="width: 13%">Scheduled Date</th>
                                    <th style="width: 13%">Marked Date</th>
                                    <th style="width: 12%">Status</th>
                                    <th style="width: 12%" class="text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in completed_activities %}
                                <tr>
                                    <td>
                                        <strong>{{ record.unit.unit_name }}</strong><br>
                                        <small class="text-muted">{{ record.unit.get_full_location }}</small>
                                    </td>
                                    <td>
                                        {% if record.activity %}
                                            {{ record.activity.activity_name }}
                                        {% else %}
                                            General Cleaning
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ record.scheduled_date|date:"M d, Y" }}<br>
                                        <small class="text-muted">{{ record.scheduled_time|time:"g:i A"|default:"--" }}</small>
                                    </td>
                                    <td>
                                        {{ record.completed_date|date:"M d, Y" }}<br>
                                        <small class="text-muted">{{ record.completed_date|time:"g:i A" }}</small>
                                    </td>
                                    <td>
                                        <span class="badge-status badge-{{ record.status|lower }}">
                                            {{ record.get_status_display }}
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <a href="{% url 'cleaning:cleaning_record_detail' record.pk %}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye me-1"></i>View
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center text-muted small">
                        Showing recent 10 completed activities
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="far fa-list-alt"></i>
                        <p>No completed activities yet</p>
                    </div>
                {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
